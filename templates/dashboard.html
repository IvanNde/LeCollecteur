<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Tableau de bord - Le Collecteur</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <header>
        <span style="font-weight:700;font-size:1.2em;letter-spacing:1px;">Le Collecteur</span>
        <nav style="display:inline-block;margin-left:40px;">
            <a href="/dashboard_html">Tableau de bord</a>
            <a href="/serveurs_html">Serveurs</a>
            <a href="/taches_html">Tâches planifiées{% if nb_alertes and nb_alertes > 0 %}<span class="badge-alert">{{ nb_alertes }}</span>{% endif %}</a>
            <a href="/logout">Déconnexion</a>
        </nav>
        <span id="theme-switch" style="float:right;margin-right:30px;"></span>
    </header>
    <div class="main-content">
        {% if notif_alerte %}
            <div class="notif notif-error" style="font-size:1.08em;">⚠️ {{ notif_alerte }}</div>
        {% endif %}
        <h1>Tableau de bord</h1>
        <div style="width:90%;margin:auto;text-align:center;">
            <div style="display:inline-block;margin:20px 40px;">
                <h2>{{ nb_serveurs }}</h2>
                <div>Serveurs enregistrés</div>
            </div>
            <div style="display:inline-block;margin:20px 40px;">
                <h2>{{ nb_exec }}</h2>
                <div>Exécutions totales</div>
            </div>
        </div>
        <h2 style="text-align:center;">Dernières exécutions</h2>
        <table border="1">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Serveur</th>
                    <th>Script</th>
                    <th>Succès</th>
                    <th>Voir log</th>
                </tr>
            </thead>
            <tbody>
            {% for log in derniers_logs %}
                <tr>
                    <td>{{ log.date_execution.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                    <td>{{ log.serveur.nom if log.serveur else 'Inconnu' }}</td>
                    <td><pre>{{ log.script }}</pre></td>
                    <td style="color:{{ 'green' if not log.error else 'red' }};font-weight:bold;">{{ 'Oui' if not log.error else 'Non' }}</td>
                    <td><a href="/logs_html?serveur_id={{ log.serveur_id }}">Voir</a></td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        <div style="text-align:center;margin-top:30px;">
            <a href="/serveurs_html">Gérer les serveurs</a>
        </div>
    </div>
    <script src="/static/theme.js"></script>
</body>
</html> 