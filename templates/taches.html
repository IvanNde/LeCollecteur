<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Tâches planifiées - Le Collecteur</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <header>
        <span style="font-weight:700;font-size:1.2em;letter-spacing:1px;">Le Collecteur</span>
        <nav style="display:inline-block;margin-left:40px;">
            <a href="/dashboard_html">Tableau de bord</a>
            <a href="/serveurs_html">Serveurs</a>
            <a href="/taches_html">Tâches planifiées</a>
            <a href="/logout">Déconnexion</a>
        </nav>
        <span id="theme-switch" style="float:right;margin-right:30px;"></span>
    </header>
    <div class="main-content">
        {% if notification %}
            <div class="notif notif-{{ notification.type }}">{{ notification.message }}</div>
        {% endif %}
        <h1>Tâches planifiées</h1>
        <div class="form-card">
            <form method="post" action="/taches_html">
                <div class="form-row">
                    <label>Serveur :</label>
                    <select name="serveur_id" required>
                        {% for s in serveurs %}
                            <option value="{{ s.id }}">{{ s.nom }} ({{ s.adresse_ip }})</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-row">
                    <label>Script :</label>
                    <input type="text" name="script" required>
                </div>
                <div class="form-row">
                    <label>Date/heure :</label>
                    <input type="datetime-local" name="date_execution" required>
                </div>
                <div class="form-row">
                    <label>Récurrence :</label>
                    <select name="recurrence">
                        <option value="none">Aucune</option>
                        <option value="daily">Tous les jours</option>
                        <option value="weekly">Toutes les semaines</option>
                    </select>
                </div>
                <div style="text-align:center;margin-top:18px;">
                    <button type="submit">Ajouter la tâche</button>
                </div>
            </form>
        </div>
        <h2>Liste des tâches</h2>
        <table border="1">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Serveur</th>
                    <th>Script</th>
                    <th>Date/heure</th>
                    <th>Récurrence</th>
                    <th>Statut</th>
                    <th>Dernier run</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
            {% for t in taches %}
                <tr>
                    <td>{{ t.id }}</td>
                    <td>{{ t.serveur.nom if t.serveur else 'Inconnu' }}</td>
                    <td><pre>{{ t.script }}</pre></td>
                    <td>{{ t.date_execution.strftime('%Y-%m-%d %H:%M') }}</td>
                    <td>{{ t.recurrence or 'Aucune' }}</td>
                    <td>{{ t.statut }}</td>
                    <td>{% if t.dernier_run %}{{ t.dernier_run.strftime('%Y-%m-%d %H:%M') }}{% endif %}</td>
                    <td>
                        <form method="post" action="/supprimer_tache_html" style="display:inline;">
                            <input type="hidden" name="tache_id" value="{{ t.id }}">
                            <button type="submit" onclick="return confirm('Supprimer cette tâche ?');">Supprimer</button>
                        </form>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    <script src="/static/theme.js"></script>
</body>
</html> 